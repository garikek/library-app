x-database-config-data:
  &mysql-connection-data
  environment:
    SPRING_DATASOURCE_PLATFORM: mysql
    MYSQL_ROOT_PASSWORD: root
    MYSQL_DATABASE: library


x-config-server:
  &spring-config
  environment:
    - eureka.client.service-Url.defaultZone=http://eureka-server:8761/eureka

x-config-microsrvice:
  &spring-database-config
  environment:
    - eureka.client.service-Url.defaultZone=http://eureka-server:8761/eureka
    - spring.datasource.url=jdbc:mysql://mysqldb:3306/library

services:
  eureka-server:
    image: garikek/eureka-server:latest
    ports:
      - 8761:8761
    <<: *spring-config
    container_name: eureka-server
    networks:
      - app
  api-gateway:
    image: garikek/api-gateway:latest
    ports:
      - 8080:8080
    <<: *spring-config
    container_name: api-gateway
    depends_on:
      - mysqldb
      - eureka-server
      - authentication-service
      - book-service
      - library-service
    networks:
      - app
  mysqldb:
    image: mysql:8.0
    restart: always
    ports:
      - 0:3306
    <<: *mysql-connection-data
    container_name: mysqldb
    networks:
      - app
  authentication-service:
    image: garikek/authentication-service:latest
    ports:
      - 8081:8081
    depends_on:
      - mysqldb
      - eureka-server
    <<: *spring-database-config
    container_name: authentication-service
    networks:
      - app
  book-service:
    image: garikek/book-service:latest
    ports:
      - 8082:8082
    depends_on:
      - mysqldb
      - eureka-server
      - authentication-service
    <<: *spring-database-config
    container_name: book-service
    networks:
      - app
  library-service:
    image: garikek/library-service:latest
    ports:
      - 8083:8083
    depends_on:
      - mysqldb
      - eureka-server
      - authentication-service
      - book-service
    <<: *spring-database-config
    container_name: library-service
    networks:
      - app
networks:
  app:

